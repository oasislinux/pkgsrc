$NetBSD: patch-CMakeLists.txt,v 1.3 2020/06/22 19:04:58 wiz Exp $

Fix locale detection.

--- CMakeLists.txt.orig	2020-06-15 02:50:34.000000000 +0000
+++ CMakeLists.txt
@@ -360,7 +360,9 @@ if(HAVE_LOCALTIME_R)
 	list(APPEND FUNCTION_DEFINES HAVE_LOCALTIME_R)
 endif()
 
-if(HAVE_NEWLOCALE AND HAVE_FREELOCALE AND HAVE_USELOCALE OR APPLE)
+check_include_files("locale.h" HAVE_LOCALE)
+
+if(HAVE_LOCALE OR APPLE)
 	list(APPEND FUNCTION_DEFINES HAVE_LOCALE)
 	if (HAVE_SNPRINTF_L)
 		list(APPEND FUNCTION_DEFINES HAVE_SNPRINTF_L)
@@ -609,19 +611,10 @@ if(WANT_SQLITE3 AND NOT USE_SQLITE3)
 endif()
 
 if(USE_LIBZIP)
-	include_directories(AFTER ${LIBZIP_INCLUDE_DIRS})
-	link_directories(${LIBZIP_LIBRARY_DIRS})
-	list(APPEND DEPENDENCY_LIB ${LIBZIP_LIBRARIES})
 	list(APPEND FEATURES LIBZIP)
 	list(APPEND VFS_SRC ${CMAKE_CURRENT_SOURCE_DIR}/src/util/vfs/vfs-zip.c)
-	string(REGEX MATCH "^[0-9]+" LIBZIP_VERSION_MAJOR ${libzip_VERSION})
-	if (LIBZIP_VERSION_MAJOR LESS 1)
-		set(CPACK_DEBIAN_PACKAGE_DEPENDS "${CPACK_DEBIAN_PACKAGE_DEPENDS},libzip2")
-	elseif(LIBZIP_VERSION_MAJOR EQUAL 1)
-		set(CPACK_DEBIAN_PACKAGE_DEPENDS "${CPACK_DEBIAN_PACKAGE_DEPENDS},libzip4|libzip5")
-	else()
-		message(AUTHOR_WARNING Unknown version of libzip detected: ${libzip_VERSION})
-	endif()
+	list(APPEND DEPENDENCY_LIB zip)
+	set(CPACK_DEBIAN_PACKAGE_DEPENDS "${CPACK_DEBIAN_PACKAGE_DEPENDS},libzip4|libzip5")
 elseif(USE_MINIZIP)
 	include_directories(AFTER ${MINIZIP_INCLUDE_DIRS})
 	link_directories(${MINIZIP_LIBRARY_DIRS})
@@ -1025,9 +1018,6 @@ endif()
 
 file(GLOB READMES ${CMAKE_CURRENT_SOURCE_DIR}/README*.md)
 
-find_program(UNIX2DOS NAMES unix2dos)
-find_program(MARKDOWN NAMES markdown kramdown pandoc)
-
 if(UNIX OR NOT UNIX2DOS)
 	if(UNIX OR NOT MARKDOWN)
 		install(FILES ${READMES} DESTINATION ${CMAKE_INSTALL_DOCDIR} COMPONENT ${BINARY_NAME})
